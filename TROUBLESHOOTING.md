# æœ¬åœ°å¼€å‘ 404 é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ› é—®é¢˜æè¿°

è®¿é—®æœ¬åœ°å¼€å‘æœåŠ¡å™¨ `http://localhost:8787/` æ—¶è¿”å› 404 é”™è¯¯ã€‚

## ğŸ” åŸå› åˆ†æ

åœ¨åŸå§‹ä»£ç ä¸­ï¼Œè·¯ç”±å™¨ä¼šæ£€æŸ¥è¯·æ±‚çš„åŸŸåæ˜¯å¦åŒ¹é… `BASE_URL`ï¼ˆå³ `img.ichiyo.in`ï¼‰ï¼š

```typescript
// åŸä»£ç 
if (url.host !== BASE_URL) {
  return new Response(generateErrorPage(404, "Not Found"), {
    status: 404,
    // ...
  });
}
```

å½“ä½ åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼š
- å®é™…è®¿é—®åŸŸåï¼š`localhost:8787` æˆ– `127.0.0.1:8787`
- é…ç½®çš„ BASE_URLï¼š`img.ichiyo.in`
- ç»“æœï¼šåŸŸåä¸åŒ¹é… â†’ è¿”å› 404

## âœ… è§£å†³æ–¹æ¡ˆ

å·²ä¿®æ”¹ `src/router/index.ts`ï¼Œæ·»åŠ æœ¬åœ°å¼€å‘ç¯å¢ƒæ£€æµ‹ï¼š

```typescript
// ä¿®æ”¹å
const isLocalhost = url.hostname === "localhost" || url.hostname === "127.0.0.1";
if (!isLocalhost && url.host !== BASE_URL) {
  return new Response(generateErrorPage(404, "Not Found"), {
    status: 404,
    // ...
  });
}
```

### å·¥ä½œåŸç†

1. **æœ¬åœ°å¼€å‘**ï¼ˆ`localhost` æˆ– `127.0.0.1`ï¼‰
   - è·³è¿‡åŸŸåæ£€æŸ¥ âœ…
   - æ­£å¸¸è®¿é—®ä¸»é¡µå’Œ API

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼ˆå®é™…åŸŸåï¼‰
   - æ£€æŸ¥åŸŸåæ˜¯å¦åŒ¹é… `BASE_URL`
   - ä¸åŒ¹é…åˆ™è¿”å› 404
   - é˜²æ­¢é€šè¿‡å…¶ä»–åŸŸåè®¿é—®

## ğŸ§ª æµ‹è¯•

ç°åœ¨å¯ä»¥æ­£å¸¸è®¿é—®ï¼š

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®ä»¥ä¸‹åœ°å€éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œ
http://localhost:8787/           # âœ… ä¸»é¡µ
http://127.0.0.1:8787/           # âœ… ä¸»é¡µ
http://localhost:8787/api/images # âœ… API
```

## ğŸ“ å…¶ä»–æ³¨æ„äº‹é¡¹

### å¦‚æœä»ç„¶ 404

1. **æ£€æŸ¥ R2 é…ç½®**
   ```jsonc
   // wrangler.jsonc
   "r2_buckets": [
     {
       "binding": "R2_IMG",
       "bucket_name": "your-bucket-name"  // ç¡®ä¿å·²ä¿®æ”¹
     }
   ]
   ```

2. **æ£€æŸ¥ç»ˆç«¯è¾“å‡º**
   - ç¡®ä¿çœ‹åˆ° `Ready on http://127.0.0.1:8787`
   - æŸ¥çœ‹æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

3. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
   - æŒ‰ `Ctrl+Shift+R` å¼ºåˆ¶åˆ·æ–°
   - æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼è®¿é—®

### å¦‚æœè®¿é—® API å‡ºé”™

API `/api/images` éœ€è¦ R2 bucket ä¸­æœ‰å›¾ç‰‡æ–‡ä»¶ã€‚å¦‚æœ bucket ä¸ºç©ºï¼š
- ä¸»é¡µä¼šæ˜¾ç¤º "No images found"
- API ä¼šè¿”å›ç©ºæ•°ç»„ï¼š`{"images": [], "cursor": null, "hasMore": false}`

è¿™æ˜¯**æ­£å¸¸è¡Œä¸º**ï¼Œä¸æ˜¯é”™è¯¯ã€‚

## ğŸš€ éƒ¨ç½²åçš„è¡Œä¸º

éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒåï¼š

```typescript
// ç”Ÿäº§ç¯å¢ƒè®¿é—®
https://img.ichiyo.in/          // âœ… æ­£å¸¸
https://other-domain.com/       // âŒ 404ï¼ˆåŸŸåä¸åŒ¹é…ï¼‰
```

è¿™æ ·å¯ä»¥é˜²æ­¢é€šè¿‡å…¶ä»–åŸŸåè®¿é—®ä½ çš„ Workerã€‚

## ğŸ’¡ å®Œå…¨ç¦ç”¨åŸŸåæ£€æŸ¥ï¼ˆä¸æ¨èï¼‰

å¦‚æœä½ æƒ³å®Œå…¨ç¦ç”¨åŸŸåæ£€æŸ¥ï¼ˆä¾‹å¦‚æ”¯æŒå¤šåŸŸåè®¿é—®ï¼‰ï¼Œå¯ä»¥æ³¨é‡Šæ‰æ•´ä¸ªæ£€æŸ¥ï¼š

```typescript
// æ³¨é‡Šæ‰åŸŸåæ£€æŸ¥
// const isLocalhost = url.hostname === "localhost" || url.hostname === "127.0.0.1";
// if (!isLocalhost && url.host !== BASE_URL) {
//   return new Response(generateErrorPage(404, "Not Found"), {
//     status: 404,
//     headers: {
//       "Content-Type": "text/html; charset=utf-8",
//       "Cache-Control": CACHE_CONTROL.NO_CACHE,
//     },
//   });
// }
```

âš ï¸ **è­¦å‘Š**ï¼šç¦ç”¨åŸŸåæ£€æŸ¥åï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡è‡ªå·±çš„åŸŸåè®¿é—®ä½ çš„ Workerï¼Œå¯èƒ½å¯¼è‡´æµé‡è¢«ç›—ç”¨ã€‚
